/* Page background */
body {
    background: radial-gradient(120% 120% at 50% 50%, rgba(0,0,0,0) 62%, rgba(0,0,0,.20) 100%),
                url('../media/backgrounds/music-background.webp'),
                var(--bg);
    background-size: cover, cover, auto;
    background-position: center, center, center;
    background-repeat: no-repeat, repeat, repeat;
    background-attachment: fixed, fixed, scroll;
}
.music-wrap {
    width: 100%;
    display: grid;
    gap: .95rem;
    justify-items: center;
    align-content: start;
    padding-bottom: clamp(.5rem, 2.5vh, 1.5rem);
}

.player { width: min(900px, 100%); display: grid; gap: .65rem }

.player .card {
    position: relative;
    padding: .95rem;
    border-radius: 1.2rem;
    background: radial-gradient(160% 120% at 0% 0%, rgba(255, 255, 255, 0.92) 0%, rgba(247, 248, 252, 0.85) 55%, rgba(240, 242, 248, 0.9) 100%);
    box-shadow: var(--shadow);
    /* Allow floating popovers (e.g., volume) to extend beyond the card */
    overflow: visible;
    transition: transform var(--dur) var(--ease), box-shadow var(--dur) var(--ease);
}

/* Make the first player card (art + labels) a bit more compact */
.player > .card:first-child { padding: .8rem; }
.player > .card:first-child .title { font-size: 1.2rem; }
.player > .card:first-child .artist { margin-top: .15rem; }

.player .card::before {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    background: linear-gradient(135deg, rgba(255, 255, 255, .55) 0%, rgba(255, 255, 255, 0) 70%);
    opacity: .75;
    border-radius: inherit;
}

.now-playing {
    display: inline-block;
    margin: 0 auto .25rem auto;
    padding: 2px 10px;
    border-radius: 999px;
    background: color-mix(in oklab, var(--accent) 12%, white);
    color: var(--accent);
    border: 1px solid color-mix(in oklab, var(--accent) 30%, white);
    font-size: .8rem;
    box-shadow: var(--shadow);
}

.cover {
    width: 100%;
    max-width: clamp(160px, 42vw, 300px);
    aspect-ratio: 1/1;
    border-radius: var(--radius);
    object-fit: cover;
    object-position: center;
    box-shadow: var(--shadow);
    display: block;
    margin: .2rem auto .45rem auto;
}
.player .card .title,
.player .card .artist { text-align: center; }

.title { font-weight: 600; font-size: 1.22rem }

.artist {
    opacity: .8;
    margin-top: .2rem;
    font-size: 1rem;
}


.controls-row { padding: .5rem .75rem; }

.controls-compact {
    display: grid;
    grid-template-rows: auto auto;
    gap: .35rem;
}

.controls-top {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: .5rem;
}

.controls-spacer { flex: 1 1 auto; }

.play-toggle {
    width: 52px;
    height: 52px;
    border-radius: 50%;
    display: grid;
    place-items: center;
    background: var(--accent);
    border: none;
    box-shadow: var(--shadow);
    cursor: pointer;
    margin: 0;
}

.play-toggle img {
    width: 24px;
    height: 24px
}

.play-toggle:hover { filter: brightness(1.03) saturate(1.02); transform: translateY(-1px); transition: transform var(--dur) var(--ease), filter var(--dur) var(--ease) }
.play-toggle:focus-visible { outline: 3px solid color-mix(in oklab, var(--accent) 45%, white); outline-offset: 2px }

.timeline { display: grid; grid-template-columns: auto 1fr auto; gap: .5rem; align-items: center; min-width: 0; }
.timeline-full { width: 100%; max-width: 620px; margin: 0 auto; }

.timeline input[type="range"] {
    width: 100%;
    height: 12px;
    border-radius: 999px;
    appearance: none;
    background: linear-gradient(var(--accent), var(--accent)) left/0% 100% no-repeat, #ececec;
}

.timeline input[type="range"]::-webkit-slider-thumb {
    appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: #fff;
    border: 2px solid var(--accent);
    box-shadow: var(--shadow)
}

.timeline input[type="range"]::-moz-range-thumb {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: #fff;
    border: 2px solid var(--accent)
}

.timeline input[type="range"]::-moz-range-track {
    height: 12px;
    border-radius: 999px;
    background: transparent
}

.timeline input[type="range"]::-moz-range-progress {
    height: 12px;
    border-radius: 999px;
    background: var(--accent)
}

.time {
    font-variant-numeric: tabular-nums;
    background: #f6f7f9;
    padding: 2px 8px;
    border-radius: 999px;
    box-shadow: inset 0 0 0 1px #e8eaee;
}

.tracklist {
    list-style: none;
    margin: 0;
    padding: 0;
    display: grid;
    gap: .5rem
}

.tracklist li {
    display: grid;
    grid-template-columns: 48px 1fr auto;
    gap: .8rem;
    align-items: center;
    padding: .6rem .8rem;
    border-radius: .8rem;
    background: #fff;
    box-shadow: var(--shadow);
    cursor: pointer;
    transition: transform var(--dur) var(--ease), box-shadow var(--dur) var(--ease), background-color var(--dur) var(--ease)
}

.tracklist li:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-2)
}

.tracklist li.active {
    outline: 2px solid var(--accent);
    background: color-mix(in oklab, var(--accent) 8%, white)
}

.tracklist .thumb {
    width: 48px;
    height: 48px;
    border-radius: .6rem;
    background-size: cover;
    background-position: center;
    box-shadow: var(--shadow);
}

.tracklist .meta {
    min-width: 0;
}
.tracklist .meta .t {
    font-weight: 600;
    display: block;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.tracklist .meta .a {
    opacity: .75;
}

.tracklist .right { min-width: 24px; }
.eq { display: grid; grid-auto-flow: column; gap: 3px; align-items: end; height: 16px; opacity: .15; transition: opacity var(--dur) var(--ease); }
.eq i { display: block; width: 3px; height: 6px; background: var(--accent); border-radius: 2px; animation: eq 1s ease-in-out infinite; animation-play-state: paused; }
.eq i:nth-child(2) { animation-delay: .15s }
.eq i:nth-child(3) { animation-delay: .3s }
.tracklist li.playing .eq { opacity: 1 }
.tracklist li.playing .eq i { animation-play-state: running }

@keyframes eq { 0%,100%{height:6px} 50%{height:16px} }

/* Pop-up style container for the list */
.tracklist-pop {
    position: relative;
    background: radial-gradient(160% 120% at 0% 0%, rgba(255, 255, 255, 0.92) 0%, rgba(247, 248, 252, 0.85) 55%, rgba(240, 242, 248, 0.9) 100%);
    border-radius: 1.2rem;
    box-shadow: var(--shadow);
    padding: .4rem;
    max-height: min(54svh, 520px);
    overflow: clip;
}

.tracklist-pop::before {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    background: linear-gradient(135deg, rgba(255, 255, 255, .55) 0%, rgba(255, 255, 255, 0) 70%);
    opacity: .75;
    border-radius: inherit;
}
.tracklist-head {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: .4rem .6rem .2rem .6rem;
    position: sticky;
    top: 0;
    background: transparent;
    z-index: 1;
}
.tracklist-head .count { opacity: .7; font-size: .9rem }
.tracklist-scroll { overflow: auto; max-height: calc(min(54svh, 520px) - 40px); padding: .2rem; }

/* Minimal custom scrollbar for the tracklist */
.tracklist-scroll { scrollbar-width: thin; scrollbar-color: color-mix(in oklab, var(--accent) 45%, #bbb) transparent; }
.tracklist-scroll::-webkit-scrollbar { width: 8px; height: 8px; }
.tracklist-scroll::-webkit-scrollbar-track { background: transparent; }
.tracklist-scroll::-webkit-scrollbar-thumb { background: color-mix(in oklab, var(--accent) 40%, #c9c9c9); border-radius: 8px; }
.tracklist-scroll::-webkit-scrollbar-thumb:hover { background: color-mix(in oklab, var(--accent) 55%, #bdbdbd); }

/* Flatten list items inside the container */
.tracklist-pop .tracklist { gap: .25rem; }
.tracklist-pop .tracklist li {
    background: #fff;
    border: 1px solid #eef0f3;
    box-shadow: var(--shadow);
    padding: .7rem 1rem;
}
.tracklist-pop .tracklist li:hover { background: #fafafa }
.tracklist-pop .tracklist li.active { background: #fff; border: 2px solid var(--accent); box-shadow: var(--shadow); }
.tracklist-pop .tracklist li.playing { border-color: var(--accent); }

/* Volume control (icon + vertical popover) */
.volume-wrap { position: relative; width: 36px; flex: 0 0 auto; }
.volume-toggle {
    display: grid;
    place-items: center;
    width: 36px;
    height: 36px;
    line-height: 0;
    border-radius: 50%;
    border: none;
    background: #fff;
    box-shadow: var(--shadow);
    cursor: pointer;
    transition: transform var(--dur) var(--ease), filter var(--dur) var(--ease)
}
.volume-toggle:hover { transform: translateY(-1px); filter: brightness(1.03) }
.volume-toggle img { width: 20px; height: 20px; display: block }

.volume-popover {
    position: absolute;
    left: 50%;
    bottom: calc(100% + 8px);
    transform: translate(-50%, 6px);
    width: 48px;
    height: 0;
    overflow: hidden;
    opacity: 0;
    pointer-events: none;
    background: rgba(255, 255, 255, .9);
    border-radius: 14px;
    box-shadow: var(--shadow);
    transition: height var(--dur) var(--ease), opacity var(--dur) var(--ease), transform var(--dur) var(--ease);
    /* Ensure it stacks above sticky headers/appbar */
    z-index: 50;
}
@supports (backdrop-filter: blur(6px)) {
    .volume-popover { background: rgba(255, 255, 255, .65); backdrop-filter: blur(8px) saturate(1.05); }
}
.volume-popover.open { opacity: 1; transform: translate(-50%, 0); pointer-events: auto }
.vp-body { padding: .45rem; display: grid; place-items: center; gap: .3rem }
/* Hide the native slider but keep width for measurement */
.volume-popover input[type="range"] { position: absolute; opacity: 0; width: 150px; height: 0; pointer-events: none }

/* Custom vertical slider */
.vslider { position: relative; width: 10px; height: 150px; background: #ececec; border-radius: 999px; margin: .4rem auto; }
.vfill { position: absolute; left: 0; bottom: 0; width: 100%; height: 0%; background: var(--accent); border-radius: 999px; transition: height .15s ease }
.vthumb { position: absolute; left: 50%; transform: translate(-50%, 50%); width: 12px; height: 12px; border-radius: 50%; background: #fff; border: 2px solid var(--accent); box-shadow: var(--shadow); transition: bottom .1s ease }
.volume-popover input[type="range"]::-webkit-slider-thumb {
    appearance: none;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: #fff;
    border: 2px solid var(--accent);
    box-shadow: var(--shadow)
}
.volume-popover input[type="range"]::-moz-range-thumb {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: #fff;
    border: 2px solid var(--accent)
}
.volume-popover input[type="range"]::-moz-range-track { height: 12px; border-radius: 999px; background: transparent }
.volume-popover input[type="range"]::-moz-range-progress { height: 12px; border-radius: 999px; background: var(--accent) }

/* Cover transitions (no rotation) */
.cover { transition: filter .3s var(--ease), opacity .35s ease }
.cover.swap { opacity: .4 }

@media (max-width: 600px) {
    /* Make the page feel less squeezed on mobile: reduce side paddings and allow a bit wider content */
    .music-wrap.container { padding-inline: clamp(.4rem, 2.5vw, 1rem); width: min(100%, 96vw); }

    .music-wrap {
        gap: .75rem;
    }

    .player { gap: .7rem; }

    .player .card {
        padding: .75rem;
    }

    .controls-row { padding: .45rem .6rem; }
    .controls-compact { gap: .3rem; }
    .controls-top { gap: .4rem; }
    .timeline-full { max-width: none; }

    .cover { max-width: clamp(140px, 44vw, 240px); margin-bottom: .35rem; }
    .title { font-size: 1.14rem; }
    .artist { font-size: .96rem; }
    .tracklist-pop { max-height: 46svh; }
    .tracklist-scroll { max-height: calc(46svh - 40px); }
}

@media (max-width: 900px), (pointer: coarse) {
    body {
        background-attachment: scroll;
        background-position: center top, center, center;
    }
}